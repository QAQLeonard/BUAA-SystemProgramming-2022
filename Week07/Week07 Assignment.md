# Week07 Assignment

> 姓名：周星达
> 学号：21373339

*阅读教材第五章并查阅网络资料，回答以下问题。*

## 1. 进程创建

`fork()`系统调用的返回值有哪几种，分别代表什么情况？

> 在父进程中，fork返回新创建子进程的进程ID；
在子进程中，fork返回0；
如果出现错误，fork返回一个负值；

## 2. 进程退出

进程的正常退出的三种方式分别是什么？

>1.从main函数退出
2.调用exit
3.调用_exit_EXIT

守护进程有哪些特点？创建一个守护进程需要哪些步骤？

>守护进程是运行在后台的一种特殊进程。它独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。
生命周期很长，守护进程会在系统启动的时候被创建并一直运行直至系统被关闭。 
它在后台运行并且不拥有控制终端。没有控制终端确保了内核永远不会为守护进程自动生成任何控制信号以及终端相关的信号（如 SIGINT、SIGQUIT）

>（1）执行一个 fork()，之后父进程退出，子进程继续执行。
（2）子进程调用 setsid() 开启一个新会话。
（3）清除进程的 umask 以确保当守护进程创建文件和目录时拥有所需的权限。
（4）修改进程的当前工作目录，通常会改为根目录（/）。
（5）关闭守护进程从其父进程继承而来的所有打开着的文件描述符。
（6）在关闭了文件描述符0、1、2之后，守护进程通常会打开/dev/null 并使用dup2() 使所有这些描述符指向这个设备。
（7）核心业务逻辑

僵尸进程是如何产生的？
>当子进程比父进程先结束，而父进程又没有回收子进程，释放子进程占用的资源，此时子进程将成为一个僵尸进程。如果父进程先退出 ，子进程被init接管，子进程退出后init会回收其占用的相关资源

## 3. 重定向

有以下一段c程序，且在该程序同目录下已经存在`a.txt`和`b.txt`文件

```c
#include<stdio.h>
#include<string.h>
#include<stdlib.h>
#include<sys/types.h>
#include<sys/stat.h>
#include<fcntl.h>

int main(){
    int fd1, fd2, fd3, fd4;
    fd1 = open("a.txt", O_RDONLY);
    fd2 = open("b.txt", O_WRONLY);
    fd3 = dup(fd1);
    fd4 = dup2(fd2, 0);
    printf("%d %d %d %d\n",fd1, fd2, fd3, fd4);
    return 0;
}
```

请问最该程序的输出是什么，并解释原因。

> ```
> 3 4 5 0
> ```
>
> open在打开文件成功时会返回首个未被使用的文件描述符，文件描述符012分别对应的是标准输入，标准输出和错误输出，因此fd1对应的是第一个未被使用的文件描述符为3，fd2为4;dup的作用为复制文件描述符，重定向输入输出，dup会返回第一个未被使用的文件描述符，因此fd3为5，而dup2有两个参数，分别为oldfd和newfd，dop2会返回第一个不小于newfd的文件描述符，因此返回值为0，fd4为0。

## 4. 管道

管道是如何实现进程间通信的？

>每个进程的空间地址是独立的，因此进程与进程之间是不能相互访问的，要进行进程间通讯，必须通过内核，内核会开辟一段特殊的内存空间，进程可以在这块内存空间进行数据的交换。
管道是一个重要的通信机制，思想是：在内存中创建一个共享文件，从而使通信双方利用这个共享文件来传递信息，由于这种方式具有单向传递数据的特点()，所以称为管道，即在某一时刻只能一端读数据一端写数据。

命名管道和无名管道的区别是什么？

> 无名管道是一种特殊类型的文件，在应用层体现打开的两个文件描述符。无名管道的使用存在限制，它只能用于父，子进程之间。
有名管道(FIFO)不同于无名管道之处在于它提供了一个路径名与之相关，以FIFO的文件形式存在于文件系统中，这样即使与FIFO的创建进程不存在亲缘关系的进程，只要可以访问该路径，就能够彼此通过FIFO相互通过FIFO不相关的进程也能交换数据。FIFO在文件系统中作为一个特殊的文件而存在，但FIFO中的内容却存放在内存中;